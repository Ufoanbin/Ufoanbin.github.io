---
layout: single
title: "시계열"
date: "2023-12-11 11:00:00 +0900"
last_modified_at: "2023-12-11 12:00:00 +0900"
author_profile: true
sidebar:
  nav: "sidebar-category"
categories:
  - Python
---

Python에서 시계열을 다루는 법<br>

## time series? 시계열?
시간관련 구조화된 데이터<br>
대량의 시계열 데이터를 표준 시계열도구와 데이터 일고리듬을 제공하는 Pandas를 이용해 효과적으로 다뤄보기

## 날짜, 시간 자료형과 관련 도구
Python 표준 라이브러리는 날짜, 시간 자료형과 달력관련 기능을 제공해준다
```python
import numpy as np
import pandas as pd

now = datetime.now() # 시간데이터는 할당 기준

now

Out: 
datetime.datetime(2023, 12, 11, 9, 17, 39, 810283)

# datetime 객체 정보
# datetime(year, month, day, hour=0, minute=0, second=0, microsecond=0, tzinfo=None, *, fold=0)

In:
now # 변수로 불러올떄 기준이 아님
Out:
datetime.datetime(2023, 12, 11, 9, 17, 39, 810283)

In:
now = datetime.now()

now
Out:
datetime.datetime(2023, 12, 11, 9, 19, 52, 977689)


In]:
now.year, now.month, now.day
Out:
(2023, 12, 11)
```

datetime.timedelta는 두 datetime 객체간 시간 차이 표현
```python
delta = datetime(2011, 1, 7) - datetime(2008, 6, 24, 8, 15)

delta
Out:
datetime.timedelta(days=926, seconds=56700)

In:
delta.days
Out:
926

In: 
delta.seconds
Out: 
56700

In: 
from datetime import timedelta

start = datetime(2011, 1, 7)

start + timedelta(12)
Out:
datetime.datetime(2011, 1, 19, 0, 0)

In:
start- 2 * timedelta(12)
Out:
datetime.datetime(2010, 12, 14, 0, 0)
```


datetime 모듈 자료형

|자료형|설명|
|------|---|
|date|날짜(연, 월, 일)|
|time|시간(시, 분, 초, 마이크로초)|
|datetime|날짜와 시간|
|timedelta|두 datetime간의 차이|
|tzinfo|표준 시간대|

## 문자열을 datetime으로 변환
```python
# datetime, Timestamp 객체는 str이나 strftime 매서드에 포맷을 넘겨 문자열로 나타낼 수 있다
stamp = datetime(2011, 1, 3)

str(stamp)
Out:
'2011-01-03 00:00:00'

In:
stamp.strftime('%Y-%m-%d')
Out:
'2011-01-03'
```

날짜 포맷 종류
```python
%a 축약 요일 이름 'Mon'
%A 요일 이름 'Monday'
%b 축약 월 이름 'Jan'
%B 월 이름 'January'
%c 전체 날짜와 시간 'Mon Jan  3 00:00:00 2011'
%p 해당 locale에서 AM, PN에 대응되는 이름(AM은 오전, PM은 오후) 'AM'
%x locale에 맞는 날짜 형식 '01/03/11'
%X locale에 맞는 시간 형식 '00:00:00'
```
## 타임스탬프로 색인된 Series
Pandas의 가장 기본적인 시계열 종류
```python
dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
			  datetime(2011, 1, 7), datetime(2011, 1, 8),
			  datetime(2011, 1, 10), datetime(2011, 1, 12)]

In [53]: ts = pd.Series(np.random.standard_normal(6), index=dates)

In [54]: ts
Out[54]:
2011-01-02    0.342111
2011-01-05   -0.743950
2011-01-07   -2.252774
2011-01-08    1.299949
2011-01-10    2.375934
2011-01-12    0.349605
dtype: float64

In [55]: ts.index
Out[55]:
DatetimeIndex(['2011-01-02', '2011-01-05', '2011-01-07', '2011-01-08',
               '2011-01-10', '2011-01-12'],
              dtype='datetime64[ns]', freq=None)
# DatetimeIndex 안에 datetime객체가 들어 있다

시계열 객체 산술 연산

In [56]: ts + ts
Out[56]:
2011-01-02    0.684221
2011-01-05   -1.487901
2011-01-07   -4.505549
2011-01-08    2.599897
2011-01-10    4.751869
2011-01-12    0.699209
dtype: float64

In [57]: ts + ts[::2]
Out[57]:
2011-01-02    0.684221
2011-01-05         NaN
2011-01-07   -4.505549
2011-01-08         NaN
2011-01-10    4.751869
2011-01-12         NaN
dtype: float64

In [58]: ts.index.dtype
Out[58]: dtype('<M8[ns]')

#DatetimeIndex의 스칼라 값은 판다스의 Timestamp 객체
In [59]: stamp = ts.index[0]

In [60]: stamp
Out[60]: Timestamp('2011-01-02 00:00:00')
```
datetime 객체 사용하는 곳 어디든 pandas.Timestamp를 사용할 수 있지만 pandas.Timpestamp는 나노초까지 저장하고 datetime은 마이크로초 까지밖에 저장이 안되기에 역으로 pandas.Timestamp 위치에 datetime을 사용하진 못한다.


## 색인, 선택, 부분 선택
```python
In [61]: stamp = ts.index[2]

In [62]: stamp
Out[62]: Timestamp('2011-01-07 00:00:00')

In [63]: ts[stamp]
Out[63]: -2.2527744915876475

In [64]: ts['2011-01-10']
Out[64]: 2.3759343735706184

In [65]: longer_ts = pd.Series(np.random.standard_normal(1000),
    ...: index=pd.date_range('2000-01-01', periods=1000))

In [66]: longer_ts
Out[66]:
2000-01-01    0.250283
2000-01-02   -0.638880
2000-01-03    1.187616
2000-01-04   -0.667004
2000-01-05    2.916072
                ...
2002-09-22   -0.758514
2002-09-23   -1.378691
2002-09-24   -2.002189
2002-09-25    0.150986
2002-09-26   -0.408640
Freq: D, Length: 1000, dtype: float64

In [67]: ts['2011-01-07']
Out[67]: -2.2527744915876475

In [68]: longer_ts['2001']
Out[68]:
2001-01-01   -0.532376
2001-01-02   -0.780179
2001-01-03    1.327738
2001-01-04   -0.212440
2001-01-05   -0.330036
                ...
2001-12-27   -1.873980
2001-12-28   -2.106718
2001-12-29    0.880992
2001-12-30    2.401561
2001-12-31    1.235846
Freq: D, Length: 365, dtype: float64

In [69]: longer_ts['2001-05']
Out[69]:
2001-05-01   -0.961049
2001-05-02   -0.222445
2001-05-03   -1.053541
2001-05-04   -0.055552
2001-05-05   -0.423829
2001-05-06   -0.286413
2001-05-07   -0.375565
2001-05-08    0.764220
2001-05-09   -1.062029
2001-05-10    1.589379
2001-05-11    1.260456
2001-05-12    0.393774
2001-05-13    1.570229
2001-05-14    0.180094
2001-05-15   -2.551377
2001-05-16   -0.517023
2001-05-17    0.030720
2001-05-18    0.352749
2001-05-19    1.007309
2001-05-20   -0.077336
2001-05-21    0.989322
2001-05-22    0.634982
2001-05-23    0.268282
2001-05-24   -0.661660
2001-05-25    0.685788
2001-05-26    0.031109
2001-05-27    2.012256
2001-05-28    0.410658
2001-05-29    0.567433
2001-05-30   -1.901030
2001-05-31   -0.388425
Freq: D, dtype: float64

In [70]: ts[datetime(2011, 1, 7):]
Out[70]:
2011-01-07   -2.252774
2011-01-08    1.299949
2011-01-10    2.375934
2011-01-12    0.349605
dtype: float64

#날짜 슬라이스는 stop부분도 포함
In [71]: ts[datetime(2011, 1, 7):datetime(2011, 1, 10)] 
Out[71]:
2011-01-07   -2.252774
2011-01-08    1.299949
2011-01-10    2.375934
dtype: float64

In [72]: ts
Out[72]:
2011-01-02    0.342111
2011-01-05   -0.743950
2011-01-07   -2.252774
2011-01-08    1.299949
2011-01-10    2.375934
2011-01-12    0.349605
dtype: float64

In [73]: ts['2011-01-06':'2011-01-11']
Out[73]:
2011-01-07   -2.252774
2011-01-08    1.299949
2011-01-10    2.375934
dtype: float64

# truncate 날짜 제한매서드
# DataFrame.truncate(before=None, after=None, axis=None, copy=None)
# before부터 after까지


In [74]: ts.truncate(after='2011-01-09')
Out[74]:
2011-01-02    0.342111
2011-01-05   -0.743950
2011-01-07   -2.252774
2011-01-08    1.299949
dtype: float64

In [75]: dates = pd.date_range('2000-01-01', periods = 100, freq='W-WED')

In [76]: dates
Out[76]:
DatetimeIndex(['2000-01-05', '2000-01-12', '2000-01-19', '2000-01-26',
               '2000-02-02', '2000-02-09', '2000-02-16', '2000-02-23',
               '2000-03-01', '2000-03-08', '2000-03-15', '2000-03-22',
               '2000-03-29', '2000-04-05', '2000-04-12', '2000-04-19',
               '2000-04-26', '2000-05-03', '2000-05-10', '2000-05-17',
               '2000-05-24', '2000-05-31', '2000-06-07', '2000-06-14',
               '2000-06-21', '2000-06-28', '2000-07-05', '2000-07-12',
               '2000-07-19', '2000-07-26', '2000-08-02', '2000-08-09',
               '2000-08-16', '2000-08-23', '2000-08-30', '2000-09-06',
               '2000-09-13', '2000-09-20', '2000-09-27', '2000-10-04',
               '2000-10-11', '2000-10-18', '2000-10-25', '2000-11-01',
               '2000-11-08', '2000-11-15', '2000-11-22', '2000-11-29',
               '2000-12-06', '2000-12-13', '2000-12-20', '2000-12-27',
               '2001-01-03', '2001-01-10', '2001-01-17', '2001-01-24',
               '2001-01-31', '2001-02-07', '2001-02-14', '2001-02-21',
               '2001-02-28', '2001-03-07', '2001-03-14', '2001-03-21',
               '2001-03-28', '2001-04-04', '2001-04-11', '2001-04-18',
               '2001-04-25', '2001-05-02', '2001-05-09', '2001-05-16',
               '2001-05-23', '2001-05-30', '2001-06-06', '2001-06-13',
               '2001-06-20', '2001-06-27', '2001-07-04', '2001-07-11',
               '2001-07-18', '2001-07-25', '2001-08-01', '2001-08-08',
               '2001-08-15', '2001-08-22', '2001-08-29', '2001-09-05',
               '2001-09-12', '2001-09-19', '2001-09-26', '2001-10-03',
               '2001-10-10', '2001-10-17', '2001-10-24', '2001-10-31',
               '2001-11-07', '2001-11-14', '2001-11-21', '2001-11-28'],
              dtype='datetime64[ns]', freq='W-WED')

In [77]: long_df = pd.DataFrame(np.random.standard_normal((100, 4)),
    ...:                        index=dates,
    ...:                        columns=['Colorado', 'Texas',
    ...:                                 'New York', 'Ohio'])

In [78]: long_df
Out[78]:
            Colorado     Texas  New York      Ohio
2000-01-05 -0.905480  1.324079  0.365718  0.076151
2000-01-12 -1.373115  0.633164 -0.897373  2.149729
2000-01-19 -0.911389  0.130302 -0.665316 -0.140677
2000-01-26 -1.400258  0.453097 -0.177497 -2.713694
2000-02-02 -0.779191  2.191557  0.667798  0.315730
...              ...       ...       ...       ...
2001-10-31  0.059472  0.950254  0.063751 -1.939683
2001-11-07  0.337514 -1.385347  0.519187 -0.770416
2001-11-14  1.467444  0.809812  0.007532  0.931004
2001-11-21 -0.614788  0.753477 -1.773878  0.859269
2001-11-28  1.434815  1.044677 -0.433526 -0.089203

[100 rows x 4 columns]

In [79]: long_df.loc['2001-05']
Out[79]:
            Colorado     Texas  New York      Ohio
2001-05-02 -0.756065 -1.491282 -0.421297 -1.265989
2001-05-09  0.196796  0.455926  1.477218 -0.253830
2001-05-16 -0.458994 -0.923634 -0.292744  0.422455
2001-05-23  0.075986 -0.881129  0.696191  0.019696
2001-05-30  0.605614  0.729502 -0.075498  0.343175
```
## 중복된 색인 갖는 시계열
```python
In [80]: dates = pd.DatetimeIndex(['2000-01-01', '2000-01-02', '2000-01-02', '2000-01-02', '2000-01-03'])

In [81]: dup_ts = pd.Series(np.arange(5), index=dates)

In [82]: dup_ts
Out[82]:
2000-01-01    0
2000-01-02    1
2000-01-02    2
2000-01-02    3
2000-01-03    4
dtype: int32

In [84]: dup_ts.index.is_unique
Out[84]: False

In [85]: dup_ts['2000-01-03']
Out[85]: 4

In [86]: dup_ts['2000-01-02']
Out[86]:
2000-01-02    1
2000-01-02    2
2000-01-02    3
dtype: int32

In [87]: grouped = dup_ts.groupby(level=0)

In [88]: grouped.mean()
Out[88]:
2000-01-01    0.0
2000-01-02    2.0
2000-01-03    4.0
dtype: float64

In [89]: grouped.count()
Out[89]:
2000-01-01    1
2000-01-02    3
2000-01-03    1
dtype: int64
```
## 날짜 범위, 빈도, 이동
```python
# 날짜범위 생성
In [90]: ts
Out[90]:
2011-01-02    0.342111
2011-01-05   -0.743950
2011-01-07   -2.252774
2011-01-08    1.299949
2011-01-10    2.375934
2011-01-12    0.349605
dtype: float64

In [91]: resampler = ts.resample('D')

In [92]: resampler
Out[92]: <pandas.core.resample.DatetimeIndexResampler object at 0x0000021EE7DBF5D0>

In [94]: index = pd.date_range('2012-04-01', '2012-06-01')

In [95]: index
Out[95]:
DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
               '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
               '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
               '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
               '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20',
               '2012-04-21', '2012-04-22', '2012-04-23', '2012-04-24',
               '2012-04-25', '2012-04-26', '2012-04-27', '2012-04-28',
               '2012-04-29', '2012-04-30', '2012-05-01', '2012-05-02',
               '2012-05-03', '2012-05-04', '2012-05-05', '2012-05-06',
               '2012-05-07', '2012-05-08', '2012-05-09', '2012-05-10',
               '2012-05-11', '2012-05-12', '2012-05-13', '2012-05-14',
               '2012-05-15', '2012-05-16', '2012-05-17', '2012-05-18',
               '2012-05-19', '2012-05-20', '2012-05-21', '2012-05-22',
               '2012-05-23', '2012-05-24', '2012-05-25', '2012-05-26',
               '2012-05-27', '2012-05-28', '2012-05-29', '2012-05-30',
               '2012-05-31', '2012-06-01'],
              dtype='datetime64[ns]', freq='D')

In [96]: pd.date_range(start='2012-04-01', periods=20)
Out[96]:
DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
               '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
               '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
               '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
               '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20'],
              dtype='datetime64[ns]', freq='D')

In [97]: pd.date_range(end='2012-04-01', periods=20)
Out[97]:
DatetimeIndex(['2012-03-13', '2012-03-14', '2012-03-15', '2012-03-16',
               '2012-03-17', '2012-03-18', '2012-03-19', '2012-03-20',
               '2012-03-21', '2012-03-22', '2012-03-23', '2012-03-24',
               '2012-03-25', '2012-03-26', '2012-03-27', '2012-03-28',
               '2012-03-29', '2012-03-30', '2012-03-31', '2012-04-01'],
              dtype='datetime64[ns]', freq='D')

In [98]: pd.date_range(start='2012-04-01', end='2022-04-01', periods=20)
Out[98]:
DatetimeIndex([          '2012-04-01 00:00:00',
               '2012-10-10 05:03:09.473684210',
               '2013-04-20 10:06:18.947368420',
               '2013-10-29 15:09:28.421052632',
               '2014-05-09 20:12:37.894736840',
               '2014-11-18 01:15:47.368421056',
               '2015-05-29 06:18:56.842105264',
               '2015-12-07 11:22:06.315789472',
               '2016-06-16 16:25:15.789473680',
               '2016-12-25 21:28:25.263157888',
               '2017-07-06 02:31:34.736842112',
               '2018-01-14 07:34:44.210526304',
               '2018-07-25 12:37:53.684210528',
               '2019-02-02 17:41:03.157894720',
               '2019-08-13 22:44:12.631578944',
               '2020-02-22 03:47:22.105263136',
               '2020-09-01 08:50:31.578947360',
               '2021-03-12 13:53:41.052631584',
               '2021-09-20 18:56:50.526315776',
                         '2022-04-01 00:00:00'],
              dtype='datetime64[ns]', freq=None)

In [99]: pd.date_range('2000-01-01', '2000-12-01', freq='BM')
Out[99]:
DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-28',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-29', '2000-10-31', '2000-11-30'],
              dtype='datetime64[ns]', freq='BM')

In [100]: pd.date_range('2012-05-02 12:56:31', periods=5)
Out[100]:
DatetimeIndex(['2012-05-02 12:56:31', '2012-05-03 12:56:31',
               '2012-05-04 12:56:31', '2012-05-05 12:56:31',
               '2012-05-06 12:56:31'],
              dtype='datetime64[ns]', freq='D')

In [101]: pd.date_range('2012-05-02 12:56:31', periods=5, normalize=True)
Out[101]:
DatetimeIndex(['2012-05-02', '2012-05-03', '2012-05-04', '2012-05-05',
               '2012-05-06'],
              dtype='datetime64[ns]', freq='D')

In [102]:

In [102]: from pandas.tseries.offsets import Hour, Minute

In [103]: hour = Hour()

In [104]: hour
Out[104]: <Hour>

In [106]: four_hours = Hour(4) # 4라는 offset값이 주어

In [107]: four_hours
Out[107]: <4 * Hours>

In [112]: pd.date_range('2000-01-01' , '2000-01-03 23:59', freq=four_hours)
Out[112]:
DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:00:00',
               '2000-01-01 08:00:00', '2000-01-01 12:00:00',
               '2000-01-01 16:00:00', '2000-01-01 20:00:00',
               '2000-01-02 00:00:00', '2000-01-02 04:00:00',
               '2000-01-02 08:00:00', '2000-01-02 12:00:00',
               '2000-01-02 16:00:00', '2000-01-02 20:00:00',
               '2000-01-03 00:00:00', '2000-01-03 04:00:00',
               '2000-01-03 08:00:00', '2000-01-03 12:00:00',
               '2000-01-03 16:00:00', '2000-01-03 20:00:00'],
              dtype='datetime64[ns]', freq='4H')

# 근데 대부분 애플리케이션에선 이런 four_hours 같은 객체를 직접 만들지 않아도
# H 나 4H 처럼 문자열로 지원이 된다. 보통 기본 빈도 앞에 정수를 두면 곱 연산된다

In [108]: pd.date_range('2000-01-01' , '2000-01-03 23:59', freq='4H')
Out[108]:
DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:00:00',
               '2000-01-01 08:00:00', '2000-01-01 12:00:00',
               '2000-01-01 16:00:00', '2000-01-01 20:00:00',
               '2000-01-02 00:00:00', '2000-01-02 04:00:00',
               '2000-01-02 08:00:00', '2000-01-02 12:00:00',
               '2000-01-02 16:00:00', '2000-01-02 20:00:00',
               '2000-01-03 00:00:00', '2000-01-03 04:00:00',
               '2000-01-03 08:00:00', '2000-01-03 12:00:00',
               '2000-01-03 16:00:00', '2000-01-03 20:00:00'],
              dtype='datetime64[ns]', freq='4H')

In [109]: Hour(2) + Minute(30)
Out[109]: <150 * Minutes>

In [110]: pd.date_range('2000-01-01', periods=10, freq='1h30min')
Out[110]:
DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 01:30:00',
               '2000-01-01 03:00:00', '2000-01-01 04:30:00',
               '2000-01-01 06:00:00', '2000-01-01 07:30:00',
               '2000-01-01 09:00:00', '2000-01-01 10:30:00',
               '2000-01-01 12:00:00', '2000-01-01 13:30:00'],
              dtype='datetime64[ns]', freq='90T')

```

## 월별 주 차
1주 차 2주 차....
빈도 클래스 WOM 사용
```python
In [113]: monthly_dates = pd.date_range('2012-01-01', '2012-09-01',
																			  freq='WOM-3FRI') # 3째주 금요일

In [114]: list(monthly_dates)
Out[114]:
[Timestamp('2012-01-20 00:00:00'),
 Timestamp('2012-02-17 00:00:00'),
 Timestamp('2012-03-16 00:00:00'),
 Timestamp('2012-04-20 00:00:00'),
 Timestamp('2012-05-18 00:00:00'),
 Timestamp('2012-06-15 00:00:00'),
 Timestamp('2012-07-20 00:00:00'),
 Timestamp('2012-08-17 00:00:00')]
```

## 데이터 시프트
시간 색인은 그대로고 데이터만 시간이동
```python
In [133]: ts = pd.Series(np.random.standard_normal(4), index=pd.date_range('2000-01-01', periods=4, freq='M'))

In [134]: ts
Out[134]:
2000-01-31    0.560864
2000-02-29   -0.908225
2000-03-31   -0.324512
2000-04-30    1.558476
Freq: M, dtype: float64

In [135]: ts.shift(2)
Out[135]:
2000-01-31         NaN
2000-02-29         NaN
2000-03-31    0.560864
2000-04-30   -0.908225
Freq: M, dtype: float64

In [136]: ts.shift(-2)
Out[136]:
2000-01-31   -0.324512
2000-02-29    1.558476
2000-03-31         NaN
2000-04-30         NaN
Freq: M, dtype: float64


In [143]: ts.shift(2, freq='M') # 월단위로 2번 뒤로이동
Out[143]:
2000-03-31    0.560864
2000-04-30   -0.908225
2000-05-31   -0.324512
2000-06-30    1.558476
Freq: M, dtype: float64

In [140]: ts.shift(3, freq='D') # 일단위로 3번 뒤로 이동
Out[140]:
2000-02-03    0.560864
2000-03-03   -0.908225
2000-04-03   -0.324512
2000-05-03    1.558476
dtype: float64

In [142]: ts.shift(1, freq='90T') # 90분 단위로 1회 뒤로 이동
Out[142]:
2000-01-31 01:30:00    0.560864
2000-02-29 01:30:00   -0.908225
2000-03-31 01:30:00   -0.324512
2000-04-30 01:30:00    1.558476
dtype: float64

In [145]: ts.shift(2, freq='90T')
Out[145]:
2000-01-31 03:00:00    0.560864
2000-02-29 03:00:00   -0.908225
2000-03-31 03:00:00   -0.324512
2000-04-30 03:00:00    1.558476
dtype: float64
```
## 오프셋 만큼 날짜 시프트
판다스의 날짜 오프셋은 datetime 이나 Timestamp 객체서도 사용가능
```python
In [146]: from pandas.tseries.offsets import Day, MonthEnd

In [147]: now = datetime(2011, 11, 17)

In [148]: now + 3 * Day()
Out[148]: Timestamp('2011-11-20 00:00:00')

In [149]: now + MonthEnd()
Out[149]: Timestamp('2011-11-30 00:00:00')

In [150]: now + MonthEnd(2)
Out[150]: Timestamp('2011-12-31 00:00:00')

In [151]: offset = MonthEnd()

In [152]: offset.rollforward(now)
Out[152]: Timestamp('2011-11-30 00:00:00')

In [153]: offset.rollback(now)
Out[153]: Timestamp('2011-10-31 00:00:00')

In [156]: ts = pd.Series(np.random.standard_normal(20), 
												 index=pd.date_range('2000-01-15', periods=20, freq='4D'))

In [158]: ts
Out[158]:
2000-01-15    0.773901
2000-01-19    1.149306
2000-01-23    0.849222
2000-01-27   -1.064424
2000-01-31    0.239438
2000-02-04   -0.294960
2000-02-08    0.439740
2000-02-12    0.843795
2000-02-16   -1.698485
2000-02-20   -0.231269
2000-02-24   -0.403453
2000-02-28    0.465591
2000-03-03    1.671663
2000-03-07    0.140890
2000-03-11    1.125359
2000-03-15   -3.224742
2000-03-19    0.302177
2000-03-23   -0.903149
2000-03-27   -0.100959
2000-03-31   -0.382737
Freq: 4D, dtype: float64

In [159]: ts.groupby(MonthEnd().rollforward).mean()
Out[159]:
2000-01-31    0.389489
2000-02-29   -0.125577
2000-03-31   -0.171437
dtype: float64

In [160]: ts.resample('M').mean()
Out[160]:
2000-01-31    0.389489
2000-02-29   -0.125577
2000-03-31   -0.171437
Freq: M, dtype: float64
```